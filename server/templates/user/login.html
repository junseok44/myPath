{% extends 'user/login_templates.html' %} {% load static %}

<div>
  {% block formContent %}
  <div class="login auth-container">
    <h2>Login</h2>
    <form action="{% url 'user_login' %}" method="post" class="login__form">
      {% csrf_token %}
      <span>
        <p class="auth__label">아이디</p>
        <input class="login-input" type="text" name="loginId" required />
      </span>
      <span>
        <p class="auth__label">비밀번호</p>
        <input class="login-input" type="password" name="password" required />
      </span>

      <button class="btn" id="login-btn" type="submit">로그인</button>
    </form>

    <div class="kakao-login">
      <a id="kakao-login-btn" href="javascript:loginWithKakao()">
        <img
          src="https://k.kakaocdn.net/14/dn/btroDszwNrM/I6efHub1SN5KCJqLm1Ovx1/o.jpg"
          width="222"
          alt="카카오 로그인 버튼"
        />
      </a>
    </div>
    <a href="{% url 'google_start' %}">
      <img src="{% static 'google_login_btn2.png' %}" />
    </a>
    <p>계정이 없으신가요? <a class="auth-link" href="{% url 'user_signup' %}">회원가입</a></p>
  </div>
  <script
    src="https://t1.kakaocdn.net/kakao_js_sdk/2.3.0/kakao.min.js"
    integrity="sha384-70k0rrouSYPWJt7q9rSTKpiTfX6USlMYjZUtr1Du+9o4cGvhPAWxngdtVZDdErlh"
    crossorigin="anonymous"
  ></script>
  <script>
    Kakao.init("{{KAKAO_CLIENT_ID}}");
    Kakao.isInitialized();

    function loginWithKakao() {
      Kakao.Auth.authorize({
        redirectUri: "{{KAKAO_REDIRECT_URL}}",
      });
    }
    displayToken();
    function displayToken() {
      var token = getCookie("authorize-access-token");

      if (token) {
        Kakao.Auth.setAccessToken(token);
        Kakao.Auth.getStatusInfo()
          .then(function (res) {
            if (res.status === "connected") {
              document.getElementById("token-result").innerText =
                "login success, token: " + Kakao.Auth.getAccessToken();
            }
          })
          .catch(function (err) {
            Kakao.Auth.setAccessToken(null);
          });
      }
    }

    function getCookie(name) {
      var parts = document.cookie.split(name + "=");
      if (parts.length === 2) {
        return parts[1].split(";")[0];
      }
    }
  </script>
  {% endblock %}
</div>
